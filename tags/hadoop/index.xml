<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Hadoop on Davidham的博客</title><link>https://davidham3.github.io/blog/tags/hadoop/</link><description>Recent content in Hadoop on Davidham的博客</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><lastBuildDate>Mon, 21 Aug 2017 16:13:59 +0000</lastBuildDate><atom:link href="https://davidham3.github.io/blog/tags/hadoop/index.xml" rel="self" type="application/rss+xml"/><item><title>Hadoop HA安装三：zookeeper的安装</title><link>https://davidham3.github.io/blog/p/hadoop-ha%E5%AE%89%E8%A3%85%E4%B8%89zookeeper%E7%9A%84%E5%AE%89%E8%A3%85/</link><pubDate>Mon, 21 Aug 2017 16:13:59 +0000</pubDate><guid>https://davidham3.github.io/blog/p/hadoop-ha%E5%AE%89%E8%A3%85%E4%B8%89zookeeper%E7%9A%84%E5%AE%89%E8%A3%85/</guid><description>&lt;p>zookeeper通常以“复制模式”运行于一个计算机集群上，这个计算机集群被称为一个“集合体”。zookeeper通过复制来实现高可用性，只要集合体中半数以上的机器处于可用状态，它就可以提供服务。出于这个原因，一个集合体通常包含奇数台机器。&lt;/p>
&lt;h1 id="zookeeper的安装">zookeeper的安装
&lt;/h1>&lt;p>zookeeper通常以“复制模式”运行于一个计算机集群上，这个计算机集群被称为一个“集合体”。zookeeper通过复制来实现高可用性，只要集合体中半数以上的机器处于可用状态，它就可以提供服务。出于这个原因，一个集合体通常包含奇数台机器。&lt;/p>
&lt;h2 id="安装">安装
&lt;/h2>&lt;p>本文选择了在cluster2，cluster3和cluster4三台机器上安装
将zookeeper解压到/usr/local目录下，并配置环境变量
&lt;code># vi /etc/profile&lt;/code>
在最下面加上2行&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="k">export&lt;/span> &lt;span class="n">ZOOKEEPER_HOME&lt;/span>&lt;span class="o">=/&lt;/span>&lt;span class="n">usr&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">local&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">zookeeper&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mf">3.4&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">6&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">export&lt;/span> &lt;span class="n">PATH&lt;/span>&lt;span class="o">=$&lt;/span>&lt;span class="n">ZOOKEEPER&lt;/span>\&lt;span class="n">_HOME&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">bin&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">PATH&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>然后在conf中新建zoo.cfg文件，输入以下内容：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"># 客户端心跳时间(毫秒)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">tickTime=2000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 允许心跳间隔的最大时间
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">initLimit=10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 同步时限
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">syncLimit=5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 数据存储目录
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">dataDir=/home/hadoop_files/hadoop_data/zookeeper
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 数据日志存储目录
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">dataLogDir=/home/hadoop_files/hadoop_logs/zookeeper/dataLog
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 端口号
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">clientPort=2181
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 集群节点和服务端口配置
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">server.1=hadoop-cluster2:2888:3888
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">server.2=hadoop-cluster3:2888:3888
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">server.3=hadoop-cluster4:2888:3888
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>创建zookeeper的数据存储目录和日志存储目录&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"># mkdir -p /home/hadoop_files/hadoop_data/zookeeper
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># mkdir -p /home/hadoop_files/hadoop_logs/zookeeper/dataLog
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># mkdir -p /home/hadoop_files/hadoop_logs/zookeeper/logs
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>修改文件夹的权限&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"># chown -R hadoop:hadoop /home/hadoop_files
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># chown -R hadoop:hadoop /usr/local/zookeeper-3.4.6
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>在cluster2号服务器的data目录中创建一个文件myid，输入内容为1，myid应与zoo.cfg中的集群节点相匹配&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"># echo &amp;#34;1&amp;#34; &amp;gt;&amp;gt; /home/hadoop_files/hadoop_data/zookeeper/myid
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>修改zookeeper的日志输出路径
&lt;code># vi bin/zkEnv.sh&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">if [ &amp;#34;x${ZOO\_LOG\_DIR}&amp;#34; = &amp;#34;x&amp;#34; ]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">then
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ZOO\_LOG\_DIR=&amp;#34;/home/hadoop\_files/hadoop\_logs/zookeeper/logs&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">fi
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">if [ &amp;#34;x${ZOO_LOG4J_PROP}&amp;#34; = &amp;#34;x&amp;#34; ]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">then
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ZOO_LOG4J_PROP=&amp;#34;INFO,ROLLINGFILE&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">fi
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>修改zookeeper的日志配置文件
&lt;code># vi conf/log4j.properties&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">zookeeper.root.logger=INFO,ROLLINGFILE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">log4j.appender.ROLLINGFILE=org.apache.log4j.DailyRollingFileAppender
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>将这个zookeeper-3.4.6的目录复制到其他的两个节点上&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"># scp -r /usr/local/zookeeper-3.4.6 cluster3:/usr/local/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># scp -r /usr/local/zookeeper-3.4.6 cluster4:/usr/local/
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>复制后在那两台机器上使用root用户修改目录所有者为hadoop用户，并修改他们的myid为2和3。&lt;/p>
&lt;p>退回hadoop用户&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"># exit
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>然后使用hadoop用户，使用&lt;code>zkServer.sh start&lt;/code>分别启动三个zookeeper，顺序无所谓。三个都启动后，使用&lt;code>jps&lt;/code>命令查看，若有QuorumPeerMain则说明服务正常启动，没有的话，使用&lt;code>zkServer.sh start-foreground&lt;/code>查看一下哪里出了问题。&lt;/p>
&lt;h2 id="安装中遇到的问题">安装中遇到的问题
&lt;/h2>&lt;ol>
&lt;li>zookeeper启动不了
使用&lt;code>zkServer.sh start-foreground&lt;/code>运行zookeeper，显示&lt;code>line 131:exec java: not found&lt;/code>
解决办法：
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"># cd /usr/local
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># chown –R hadoop:hadoop zookeeper-3.4.6
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>改一下用户权限即可&lt;/li>
&lt;li>打开logs文件夹里面的zookeeper.log显示connection refused错误
原因：一般来说这是配置的问题，我出现这个问题的主要原因是，我在zoo.cfg中写了三个server，但是只在server1上启动zkServer.sh所以会出现connection refused。
事实上只在一个机器上启动zookeeper时，使用&lt;code>zkServer.sh status&lt;/code>查看状态时，会显示zk可能没有运行，但是这并不是说明你的zookeeper有问题，只是那两个还没启动好而已，当3台机器的zookeeper都启动后，3台机器会自动进行投票，选出一个leader两个follower，此时再用&lt;code>zkServer.sh status&lt;/code>查看状态的时候就可以看到这台机器是leader还是follower了。&lt;/li>
&lt;/ol></description></item><item><title>Hadoop HA安装二：MySQL双机热备</title><link>https://davidham3.github.io/blog/p/hadoop-ha%E5%AE%89%E8%A3%85%E4%BA%8Cmysql%E5%8F%8C%E6%9C%BA%E7%83%AD%E5%A4%87/</link><pubDate>Mon, 21 Aug 2017 16:13:31 +0000</pubDate><guid>https://davidham3.github.io/blog/p/hadoop-ha%E5%AE%89%E8%A3%85%E4%BA%8Cmysql%E5%8F%8C%E6%9C%BA%E7%83%AD%E5%A4%87/</guid><description>&lt;p>Hadoop HA安装二：MySQL双机热备&lt;/p>
&lt;h2 id="安装mysql">安装MySQL
&lt;/h2>&lt;p>安装前先安装一下MySQL的依赖
ubuntu:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"># apt-get install libaio-dev
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>CentOS:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"># yum install libaio
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>看了很多教程都不靠谱。。。还是官方教程最靠谱：
&lt;a class="link" href="https://dev.mysql.com/doc/refman/5.6/en/binary-installation.html" target="_blank" rel="noopener"
>Installing MySQL on Unix/Linux Using Generic Binaries&lt;/a>&lt;/p>
&lt;p>下载mysql-5.6.37-linux-glibc2.12-x86_64
&lt;code># cp mysql-5.6.37-linux-glibc2.12-x86_64.tar.gz /usr/local/&lt;/code>&lt;/p>
&lt;p>解压到/usr/local/
&lt;code># tar -zxvf mysql-5.6.37-linux-glibc2.12-x86_64.tar.gz&lt;/code>&lt;/p>
&lt;p>改名为mysql
&lt;code># mv mysql-5.6.37-linux-glibc2.12-x86_64 mysql&lt;/code>&lt;/p>
&lt;p>删除安装包
&lt;code># rm mysql-5.6.37-linux-glibc2.12-x86_64.tar.gz&lt;/code>&lt;/p>
&lt;p>修改环境变量
&lt;code># vi /etc/profile&lt;/code>
在最下面添加&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="k">export&lt;/span> &lt;span class="n">MYSQL_HOME&lt;/span>&lt;span class="o">=/&lt;/span>&lt;span class="n">usr&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">local&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">mysql&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">export&lt;/span> &lt;span class="n">PATH&lt;/span>&lt;span class="o">=$&lt;/span>&lt;span class="n">MYSQL_HOME&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">bin&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">PATH&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>新建用户和用户组：mysql
&lt;code># groupadd mysql&lt;/code>
&lt;code># useradd -r -g mysql -s /bin/false mysql&lt;/code>&lt;/p>
&lt;p>&lt;code># cd /usr/local/mysql&lt;/code>&lt;/p>
&lt;p>修改目录的拥有者
&lt;code># chown -R mysql .&lt;/code>(&lt;strong>重要！&lt;/strong>)
&lt;code># chgrp -R mysql .&lt;/code>(&lt;strong>重要！&lt;/strong>)&lt;/p>
&lt;p>安装MySQL
&lt;code># scripts/mysql_install_db --user=mysql&lt;/code>&lt;/p>
&lt;p>修改当前目录拥有者为root用户
&lt;code># chown -R root .&lt;/code>&lt;/p>
&lt;p>修改当前data目录拥有者为mysql用户
&lt;code># chown -R mysql data&lt;/code>&lt;/p>
&lt;p>启动MySQL进程
&lt;code># bin/mysqld_safe --user=mysql &amp;amp;&lt;/code>&lt;/p>
&lt;p>此时这个窗口会卡住，新建一个terminal，进入/usr/local/mysql中&lt;/p>
&lt;p>进入mysql控制台
&lt;code># bin/mysql&lt;/code>&lt;/p>
&lt;p>退出
&lt;code>exit;&lt;/code>&lt;/p>
&lt;p>进行MySQL的root用户密码的修改等操作
&lt;code># ./bin/mysql_secure_installation&lt;/code>
首先要求输入root密码，由于我们没有设置过root密码，括号里面说了，如果没有root密码就直接按回车。是否设定root密码，选y，设定密码为cluster，是否移除匿名用户：y。然后有个是否关闭root账户的远程登录，选n，删除test这个数据库？y，更新权限？y，然后ok。&lt;/p>
&lt;p>&lt;code># cp support-files/mysql.server /etc/init.d/mysql.server&lt;/code>&lt;/p>
&lt;p>查看MySQL的进程号
&lt;code># ps -ef | grep mysql&lt;/code>&lt;/p>
&lt;p>如果有的话就kill掉，保证MySQL已经中断运行了，一般kill掉/usr/local/mysql/bin/mysqld开头的即可
&lt;code># kill 进程号&lt;/code>&lt;/p>
&lt;p>启动MySQL
&lt;code># /etc/init.d/mysql.server start -user=mysql&lt;/code>
&lt;code># exit&lt;/code>&lt;/p>
&lt;p>还需要配置一下访问权限：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">$ mysql -u root -p
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mysql&amp;gt; GRANT ALL PRIVILEGES ON *.* TO &amp;#39;root&amp;#39;@&amp;#39;%&amp;#39; IDENTIFIED BY &amp;#39;cluster&amp;#39; WITH GRANT OPTION;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mysql&amp;gt; FLUSH PRIVILEGES;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>这样就可以使用root用户在任意地点登陆，而不再限于localhost了
关于服务的三个命令。
启动mysql：&lt;code># /etc/init.d/mysql.server start -user=mysql&lt;/code>
停止mysql：&lt;code># mysqladmin -u root -p shutdown&lt;/code>&lt;/p>
&lt;h2 id="修改mysql的数据存储位置">修改MySQL的数据存储位置
&lt;/h2>&lt;p>在装系统进行分区的时候，有些时候会创建比较大的分区开存数据，我们可以将MySQL的数据存放到这个区内，假设这个区为/file0&lt;/p>
&lt;p>&lt;code>$ su root&lt;/code>&lt;/p>
&lt;p>把MySQL服务进程停掉：
&lt;code># mysqladmin -u root -p shutdown&lt;/code>&lt;/p>
&lt;p>新建新的dataDir
&lt;code># mkdir /file0/mysql_data&lt;/code>&lt;/p>
&lt;p>把/usr/local/mysql/data里面的东西移到/file0/mysql_data下
&lt;code># cp /usr/local/mysql/data/* /file0/mysql_data&lt;/code>&lt;/p>
&lt;p>编辑MySQL的配置文件/etc/my.cnf
如果没有的话，就把/usr/local/mysql里面的my.cnf复制过去
&lt;code># cp /usr/local/mysql/my.cnf /etc/&lt;/code>
&lt;code># vi /etc/my.cnf&lt;/code>&lt;/p>
&lt;p>把里面的basedir, datadir, port修改成下面的内容&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">basedir=/usr/local/mysql
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">datadir=/file0/mysql_data
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">port=3306
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>修改MySQL启动脚本/etc/init.d/mysql.server
&lt;code># vi /etc/init.d/mysql.server&lt;/code>
把里面的basedir和datadir作如上修改&lt;/p>
&lt;p>修改新目录的权限：
&lt;code># chown –R mysql /file0/mysql_data&lt;/code>
&lt;code># chgrp –R mysql /file0/mysql_data&lt;/code>
退出root用户
重新启动MySQL服务
&lt;code>$ /etc/init.d/mysql.server start –user=mysql&lt;/code>&lt;/p>
&lt;p>进入mysql
&lt;code>$ mysql –u root -p&lt;/code>&lt;/p>
&lt;p>查看目录是否已经更改
&lt;code>mysql&amp;gt; show variables like “datadir”;&lt;/code>&lt;/p>
&lt;h2 id="高可用的mysql双机热备安装教程">高可用的MySQL双机热备安装教程
&lt;/h2>&lt;p>开启二进制日志，设置id
&lt;code># vi /etc/my.cnf&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[mysqld]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">server-id = 1 #backup这台设置2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">log-bin = mysql-bin
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">binlog-ignore-db = mysql,information_schema #忽略写入binlog日志的库
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">auto-increment-increment = 2 #字段变化增量值
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">auto-increment-offset = 1 #初始字段ID为1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">slave-skip-errors = all #忽略所有复制产生的错误
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>重启MySQL服务
&lt;code># mysqladmin -u root -p shutdown&lt;/code>
&lt;code># /etc/init.d/mysql.server start –user=mysql&lt;/code>&lt;/p>
&lt;p>先查看下log bin日志和pos值位置
里面有个File和Position，分别是log_file和log_pos的值，一会儿要填
&lt;code>mysql&amp;gt; show master status;&lt;/code>&lt;/p>
&lt;p>master配置如下：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">mysql&amp;gt; GRANT REPLICATION SLAVE ON *.* TO &amp;#39;replication&amp;#39;@&amp;#39;192.168.1.%&amp;#39; IDENTIFIED BY &amp;#39;replication&amp;#39;;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mysql&amp;gt; flush privileges;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mysql&amp;gt; change master to
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -&amp;gt; master_host=&amp;#39;192.168.1.212&amp;#39;, # 此处输入slave的ip地址
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -&amp;gt; master_user=&amp;#39;replication&amp;#39;,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -&amp;gt; master_password=&amp;#39;replication&amp;#39;,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -&amp;gt; master_log_file=&amp;#39;mysql-bin.000001&amp;#39;,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -&amp;gt; master_log_pos=120; #对端状态显示的值
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mysql&amp;gt; start slave; #启动同步
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>backup配置如下：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">mysql&amp;gt; GRANT REPLICATION SLAVE ON *.* TO &amp;#39;replication&amp;#39;@&amp;#39;192.168.1.%&amp;#39; IDENTIFIED BY &amp;#39;replication&amp;#39;;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mysql&amp;gt; flush privileges;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mysql&amp;gt; change master to
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -&amp;gt; master_host=&amp;#39;192.168.1.211&amp;#39;, # 此处输入master的ip地址
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -&amp;gt; master_user=&amp;#39;replication&amp;#39;,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -&amp;gt; master_password=&amp;#39;replication&amp;#39;,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -&amp;gt; master_log_file=&amp;#39;mysql-bin.000001&amp;#39;,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -&amp;gt; master_log_pos=120;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mysql&amp;gt; start slave;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>MySQL双击热备安装完成&lt;/p>
&lt;h2 id="测试">测试
&lt;/h2>&lt;p>在一台机器上建立一个数据库，创建一个表，在另一台机器上查询是有结果的，说明安装成功。&lt;/p></description></item><item><title>Hadoop HA安装一：在Linux中安装和配置ntp，ssh和jdk</title><link>https://davidham3.github.io/blog/p/hadoop-ha%E5%AE%89%E8%A3%85%E4%B8%80%E5%9C%A8linux%E4%B8%AD%E5%AE%89%E8%A3%85%E5%92%8C%E9%85%8D%E7%BD%AEntpssh%E5%92%8Cjdk/</link><pubDate>Mon, 21 Aug 2017 16:13:25 +0000</pubDate><guid>https://davidham3.github.io/blog/p/hadoop-ha%E5%AE%89%E8%A3%85%E4%B8%80%E5%9C%A8linux%E4%B8%AD%E5%AE%89%E8%A3%85%E5%92%8C%E9%85%8D%E7%BD%AEntpssh%E5%92%8Cjdk/</guid><description>&lt;p>Hadoop HA安装一：安装和配置ntp，ssh和jdk&lt;/p>
&lt;p>记录一下安装5节点的高可用Hadoop集群的安装过程。High availability表示高可用，在Hadoop集群中，表示两个主节点。HDFS中是两个Namenode，Yarn中是两个ResourceManager。本教程中的Hadoop和HBase均为HA，MySQL为双机热备。&lt;/p>
&lt;p>操作系统：CentOS 7.&lt;/p>
&lt;p>软件服务如下：&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>软件&lt;/th>
&lt;th>版本&lt;/th>
&lt;th>路径&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>JDK&lt;/td>
&lt;td>1.7.80&lt;/td>
&lt;td>/usr/local/jdk1.7.0_80&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>MySQL&lt;/td>
&lt;td>5.6.37&lt;/td>
&lt;td>/usr/local/mysql&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Zookeeper&lt;/td>
&lt;td>3.4.6&lt;/td>
&lt;td>/usr/local/zookeeper-3.4.6&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Kafka&lt;/td>
&lt;td>0.8.2.1&lt;/td>
&lt;td>/usr/local/kafka_2.10.-0.8.2.1&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Hadoop&lt;/td>
&lt;td>2.6.5&lt;/td>
&lt;td>/usr/local/hadoop-2.6.5&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>HBase&lt;/td>
&lt;td>1.2.6&lt;/td>
&lt;td>/usr/local/hbase-1.2.6&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Hive&lt;/td>
&lt;td>1.1.0&lt;/td>
&lt;td>/usr/local/apache-hive-1.1.0-bin&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>MySQL JDBC&lt;/td>
&lt;td>5.1.43&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Scala&lt;/td>
&lt;td>2.10.6&lt;/td>
&lt;td>/usr/local/scala-2.10.6&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Spark&lt;/td>
&lt;td>1.6.3&lt;/td>
&lt;td>/usr/local/spark-1.6.3-bin-hadoop2.6&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Storm&lt;/td>
&lt;td>1.1.1&lt;/td>
&lt;td>/usr/local/apache-storm-1.1.1&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Sqoop&lt;/td>
&lt;td>1.4.6&lt;/td>
&lt;td>/usr/local/sqoop-1.4.6&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Pig&lt;/td>
&lt;td>0.16.0&lt;/td>
&lt;td>/usr/local/pig-0.16.0&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>各节点搭载的服务为：&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Hostname&lt;/th>
&lt;th>Services&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>cluster1&lt;/td>
&lt;td>NameNode, DataNode, ZKFC, ResourceManager, NodeManager, HMaster, HRegionServer, Master, Worker, MySQL&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>cluster2&lt;/td>
&lt;td>QuorumPeerMain, NameNode, DataNode, ZKFC, ResourceManager, NodeManager, HMaster, HRegionServer, Worker, MySQL&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>cluster3&lt;/td>
&lt;td>QuorumPeerMain, DataNode, NodeManager, HRegionServer, Worker, Kafka, nimbus, core, logviewer&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>cluster4&lt;/td>
&lt;td>QuorumPeerMain, DataNode, NodeManager, HRegionServer, Worker, Kafka, Supervisor, logviewer&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>cluster5&lt;/td>
&lt;td>DataNode, NodeManager, HRegionServer, Worker, Kafka, Supervisor, logviewer&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>&lt;strong>本系列教程中，命令以#开头的是需要使用root用户执行，$开头的使用普通用户（一般为hadoop用户）。而且本教程的操作系统是CentOS7，有些配置文件内的内容可能与Ubuntu等系统不符。&lt;/strong>&lt;/p>
&lt;h1 id="关闭防火墙和selinux">关闭防火墙和Selinux
&lt;/h1>&lt;p>// 关闭防火墙和selinux
&lt;code># systemctl stop firewalld.service&lt;/code>&lt;/p>
&lt;p>// 禁止firewall 开机启动
&lt;code># systemctl disable firewalld.service&lt;/code>&lt;/p>
&lt;p>// 开机关闭Selinux，编辑Selinux配置文件
&lt;code># vi /etc/selinux/config&lt;/code>
将SELINUX设置为disabled
如下:
&lt;code>SELINUX=disabled&lt;/code>
&lt;strong>千万别把SELINUXTYPE改了！&lt;/strong>&lt;/p>
&lt;p>// 重启
&lt;code># reboot&lt;/code>&lt;/p>
&lt;p>// 重启机器后root用户查看Selinux状态
&lt;code># getenforce&lt;/code>&lt;/p>
&lt;h1 id="修改hosts文件">修改hosts文件
&lt;/h1>&lt;p>假设5台机器的IP地址分别为192.168.1.211-192.168.1.215
每台机器都要做如下修改：
// 修改hosts
&lt;code># vi /etc/hosts&lt;/code>
// 在最下面添加以下几行内容&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">192.168.1.211 cluster1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.212 cluster2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.213 cluster3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.214 cluster4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.215 cluster5
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>修改成这个样子后，对于这台机器来说，cluster1就代表了192.168.1.211，其他的也同理。&lt;/p>
&lt;h1 id="ntp的安装与配置">ntp的安装与配置
&lt;/h1>&lt;p>一个集群内需要有一个机器运行ntp server，其他机器用ntpdate向它同步时间。Hbase和Spark都要求时间是严格同步的，所以ntp是必需的。
我们将ntp server设置在cluster1上，所以只在cluster1上面安装ntpserver，在其他机器上安装ntpdate。&lt;/p>
&lt;p>ubuntu下使用如下命令安装&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"># apt-get install ntp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># apt-get install ntpdate
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>CentOS使用&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"># yum install ntp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># yum install ntpdate
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>配置时间服务器：&lt;/p>
&lt;p>// cluster1上执行以下操作
&lt;code># vi /etc/ntp.conf&lt;/code>&lt;/p>
&lt;p>注释掉以下4行，也就是在这4行前面加#&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">server 0.centos.pool.ntp.org iburst
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">server 1.centos.pool.ntp.org iburst
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">server 2.centos.pool.ntp.org iburst
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">server 3.centos.pool.ntp.org iburst
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>最下面加入以下内容，192.168.1.1和255.255.255.0分别为网关和掩码，127.127.1.0表示以本机时间为标准。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">restrict default ignore
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">restrict 192.168.1.1 mask 255.255.255.0 nomodify notrap
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">server 127.127.1.0
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>保存后ubuntu使用&lt;code># /etc/init.d/ntp restart&lt;/code>重启ntp服务，CentOS使用&lt;code># service ntpd restart&lt;/code>
除了搭载ntp server的主机，其他所有机器，设定每天00:00向ntp server同步时间，并写入日志
&lt;code># crontab –e&lt;/code>
添加以下内容&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">0 0 * * * /usr/sbin/ntpdate cluster1&amp;gt;&amp;gt; /home/hadoop/ntpd.log
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>这样就完成了ntp的配置&lt;/p>
&lt;p>// 手动同步时间，需要在每台机器上（除ntp server），使用&lt;code>ntpdate cluster1&lt;/code>同步时间
&lt;code># ntpdate cluster1&lt;/code>&lt;/p>
&lt;h1 id="新建hadoop用户">新建hadoop用户
&lt;/h1>&lt;p>每台机器上都要新建hadoop用户，这个用户专门用来维护集群，因为实际中使用root用户的机会很少，而且不安全。
// 新建hadoop组
&lt;code># groupadd hadoop&lt;/code>&lt;/p>
&lt;p>// 新建hadoop用户
&lt;code># useradd -s /bin/bash -g hadoop -d /home/hadoop -m hadoop&lt;/code>&lt;/p>
&lt;p>// 修改hadoop这个用户的密码
&lt;code># passwd hadoop&lt;/code>&lt;/p>
&lt;h1 id="ssh密钥的生成与分发">ssh密钥的生成与分发
&lt;/h1>&lt;p>ssh是Linux自带的服务，不需要安装。这里的目的是让节点间实现无密码登陆。其实就是当前机器生成密钥，然后用&lt;code>ssh-copy-id&lt;/code>复制到其他机器上，这样这台机器就可以无密码直接登陆那台机器了。Hadoop主节点需要能无密码连接到其他的机器上。&lt;/p>
&lt;p>在cluster1上，使用hadoop用户&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">// 使用hadoop用户
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># su hadoop
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">// 切到home目录
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ cd ~/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">// 生成密钥
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ssh-keygen -t rsa
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">// 一路回车
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">//复制密钥
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ ssh-copy-id cluster1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">yes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">输入cluster的密码
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ ssh-copy-id cluster2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">同上
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ ssh-copy-id cluster3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">同上
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ ssh-copy-id cluster4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">同上
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ ssh-copy-id cluster5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">同上
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">// 然后测试能否无密码登陆
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ ssh cluster1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ ssh cluster2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ ssh cluster3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ ssh cluster4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ ssh cluster5
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>查看登陆时是否有密码，若无密码，则配置成功。
以上步骤需要在cluster2上也执行一遍，为了让cluster2也可以无密码登陆到其他机器上，因为cluster2也是主节点。&lt;/p>
&lt;h1 id="jdk的安装与配置">jdk的安装与配置
&lt;/h1>&lt;p>安装hadoop集群，jdk是必须要装的，1.7和1.8都可以，不过从Hadoop3开始，好像只支持1.8+了，但是换成1.9和1.10会出问题，所以推荐用1.8，我这里用的是1.7。&lt;/p>
&lt;p>将下载好后的jdk解压到/usr/local/下
&lt;code># vi /etc/profile&lt;/code>
将下面4行添加到环境变量中&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="k">export&lt;/span> &lt;span class="n">JAVA_HOME&lt;/span>&lt;span class="o">=/&lt;/span>&lt;span class="n">usr&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">local&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">jdk1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">7.0&lt;/span>&lt;span class="n">_80&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">export&lt;/span> &lt;span class="n">JRE_HOME&lt;/span>&lt;span class="o">=/&lt;/span>&lt;span class="n">usr&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">local&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">jdk1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">7.0&lt;/span>&lt;span class="n">_80&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">jre&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">export&lt;/span> &lt;span class="n">CLASSPATH&lt;/span>&lt;span class="o">=.&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">JAVA&lt;/span>\&lt;span class="n">_HOME&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">lib&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">JRE_HOME&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">lib&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">CLASSPATH&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">export&lt;/span> &lt;span class="n">PATH&lt;/span>&lt;span class="o">=$&lt;/span>&lt;span class="n">JAVA_HOME&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">bin&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">JRE&lt;/span>\&lt;span class="n">_HOME&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">bin&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">JAVA_HOME&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">PATH&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>使用&lt;code># source /etc/profile&lt;/code>刷新环境变量
使用&lt;code># java -version&lt;/code>查看java版本验证是否安装成功，如果能看到Java的版本，说明安装成功，没有问题。&lt;/p></description></item></channel></rss>